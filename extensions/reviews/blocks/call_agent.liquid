<div>
    <input id="myInput" type="text" placeholder="Enter a query">
    <button id="myButton">Call Agent</button>
</div>

<div>
    <h2>Response Data:</h2>
    <p id="prompt"></p>
    <p id="sqlQuery"></p>
    <p id="result"></p>
    <p id="error"></p>
    <p id="output"></p>
</div>

<script>

</script>


<script>
    const button = document.querySelector('#myButton');
    button.addEventListener('click', async function(event) {
        event.preventDefault();
        const input = document.querySelector('#myInput');
        const value = input.value;
        console.log("Button clicked with value:", value);
        const data = { agentQuery: value, userMode: false, tableToQuery: "Review" };

        const response = await fetch('/apps/my_app/agent', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        if (response.ok) {
            const responseData = await response.json();
            console.log("API response:", responseData);
            // Parse the response data here
            const prompt = responseData.prompt;
            const sqlQuery = responseData.sqlQuery;
            const result = responseData.result;
            const error = responseData.error;
            const output = responseData.output;

            // Pass the data to frontend
            const promptElement = document.querySelector('#prompt');
            const sqlQueryElement = document.querySelector('#sqlQuery');
            const resultElement = document.querySelector('#result');
            const errorElement = document.querySelector('#error');
            const outputElement = document.querySelector('#output');

            promptElement.innerHTML = prompt;
            sqlQueryElement.innerHTML = sqlQuery;
            resultElement.innerHTML = result;
            errorElement.innerHTML = error;
            outputElement.innerHTML = output;
        } else {
            console.error("API call failed with status:", response.status);
        }
    });
</script>

{% schema %}
{
    "name": "Call Agent",
    "target": "section",
    "settings": []
}
{% endschema %}